(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/poster-poster/index"],{"017b":function(t,e,i){"use strict";(function(t){var n=i("4ea4");Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=n(i("2eee")),a=n(i("c973")),s=i("84d8"),r=i("d1ea"),c=n(i("19b6")),u={components:{zbCode:function(){Promise.all([i.e("common/vendor"),i.e("components/zb-code/zb-code")]).then(function(){return resolve(i("92ed"))}.bind(null,i)).catch(i.oe)}},mixins:[c.default],props:{comType:{type:String,default:"0"},comId:{type:String,default:"0"},comBargain:{type:String,default:"0"}},data:function(){return{canvasStatus:!0,posterImage:"",parameter:{navbar:"1",return:"1",title:this.$t("拼团海报"),color:!0,class:"0"},type:0,id:0,bargain:0,image:"",from:"",uid:"",codeShow:!1,cid:"1",ifShow:!0,val:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",icon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,src:"",codeSrc:"",wd:0,hg:0,posterBag:"../static/posterBag.png",mpUrl:""}},onLoad:function(e){if(1!=this.comType){this.from="routine";if(!e.hasOwnProperty("type")||!e.hasOwnProperty("id"))return app.Tips({title:this.$t("参数错误"),icon:"none"},{tab:3,url:1});this.type=e.type,this.id=e.id,1==e.type?(this.bargain=e.bargain,t.setNavigationBarTitle({title:this.$t("砍价海报")})):t.setNavigationBarTitle({title:this.$t("拼团海报")})}},mounted:function(){var e=this;if(1==this.comType){this.from="routine";t.setNavigationBarTitle({title:this.$t("砍价海报")}),this.type=this.comType,this.id=this.comId,this.bargain=this.comBargain,this.$nextTick((function(){t.createSelectorQuery().in(e).select(".pictrue").boundingClientRect((function(t){e.wd=t.width,e.hg=t.height})).exec()})),this.routineCode(),setTimeout((function(t){e.getPosterInfo()}),200)}},onReady:function(){1!=this.comType&&(setTimeout((function(t){}),200),this.$nextTick((function(){var e=this,i=t.createSelectorQuery().select(".pictrue");i.fields({size:!0},(function(t){e.wd=t.width,e.hg=t.height,e.getPosterInfo()})).exec()})),this.routineCode())},methods:{getPosterInfo:function(){var e=this;return(0,a.default)(o.default.mark((function i(){var n,a,c,u,l;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e,"",{id:n.id,from:n.from},i.next=4,(0,r.getUserInfo)();case 4:if(a=i.sent,e.uid=a.data.uid,t.showLoading({title:n.$t("海报生成中"),mask:!0}),1!=n.type){i.next=12;break}return i.next=10,(0,s.getBargainPosterData)(n.id).then((function(t){c=t.data})).catch((function(t){n.$util.Tips({title:n.$t("海报图片获取失败")})}));case 10:i.next=14;break;case 12:return i.next=14,(0,s.getCombinationPosterData)(n.id).then((function(t){c=t.data})).catch((function(t){n.$util.Tips({title:n.$t("海报图片获取失败")})}));case 14:if(c.image=n.setDomain(c.image),!c.url){i.next=21;break}return i.next=18,e.downloadFilestoreImage(c.url);case 18:i.t0=i.sent,i.next=24;break;case 21:return i.next=23,e.downloadFilestoreImage(e.mpUrl);case 23:i.t0=i.sent;case 24:return l=i.t0,i.t1=e.posterBag,i.next=28,e.downloadFilestoreImage(c.image);case 28:i.t2=i.sent,i.t3=l,u=[i.t1,i.t2,i.t3],e.$nextTick((function(t){n.$util.bargainPosterCanvas(u,c.title,c.label,c.msg,c.price,e.wd,e.hg,(function(t){e.posterImage=t,e.$emit("getPosterImgae",t)}))}));case 32:case"end":return i.stop()}}),i)})))()},routineCode:function(){var t=this;return(0,a.default)(o.default.mark((function e(){var i;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,r.routineCode)();case 2:i=e.sent,t.mpUrl=i.data.url;case 4:case"end":return e.stop()}}),e)})))()},downloadFilestoreImage:function(e){var i=this;return new Promise((function(n,o){var a=i;t.downloadFile({url:e,success:function(t){n(t.tempFilePath)},fail:function(){return a.$util.Tips({title:""})}})}))},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},imgToBase:function(t,e){return(0,a.default)(o.default.mark((function i(){var n;return o.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,(0,r.imgToBase)({image:t,code:e});case 2:return n=i.sent,i.abrupt("return",n.data);case 4:case"end":return i.stop()}}),i)})))()},downloadImg:function(){},savePosterPathMp:function(e){var i=this;t.getSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e,success:function(t){i.$util.Tips({title:i.$t("保存成功"),icon:"success"})},fail:function(t){i.$util.Tips({title:i.$t("保存失败")})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e,success:function(t){i.$util.Tips({title:i.$t("保存成功"),icon:"success"})},fail:function(t){i.$util.Tips({title:i.$t("保存失败")})}})},fail:function(t){i.$util.Tips({title:i.$t("保存失败")})}})}})},qrR:function(t){this.codeSrc=t},savePosterPath:function(){var e=this;t.getSetting({success:function(i){i.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:e.$t("保存成功"),icon:"success"})},fail:function(t){e.$util.Tips({title:e.$t("保存失败")})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:e.$t("保存成功"),icon:"success"})},fail:function(t){e.$util.Tips({title:e.$t("保存失败")})}})}})}})}}};e.default=u}).call(this,i("543d")["default"])},"2c1b":function(t,e,i){"use strict";i.r(e);var n=i("8ff4"),o=i("6e82");for(var a in o)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(a);i("8d4f");var s=i("f0c5"),r=Object(s["a"])(o["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],void 0);e["default"]=r.exports},"6e82":function(t,e,i){"use strict";i.r(e);var n=i("017b"),o=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(a);e["default"]=o.a},"8d4f":function(t,e,i){"use strict";var n=i("f6c9"),o=i.n(n);o.a},"8ff4":function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){}));var n=function(){var t=this.$createElement,e=(this._self._c,this.$t("提示：点击图片即可保存至手机相册"));this.$mp.data=Object.assign({},{$root:{m0:e}})},o=[]},b6af:function(t,e,i){"use strict";(function(t,e){var n=i("4ea4");i("4789");n(i("66fd"));var o=n(i("2c1b"));t.__webpack_require_UNI_MP_PLUGIN__=i,e(o.default)}).call(this,i("bc2e")["default"],i("543d")["createPage"])},f6c9:function(t,e,i){}},[["b6af","common/runtime","common/vendor"]]]);